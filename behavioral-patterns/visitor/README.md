# Visitor Design Pattern in Vim9script

## Overview

The **Visitor Pattern** is a behavioral design pattern that lets you separate algorithms from the objects on which they operate. It allows new operations to be added without modifying element classes.

## Intent

- Define new operations without changing element classes
- Keep related operations together
- Enable double-dispatch behavior

## Also Known As

- Double Dispatch

## When to Use

Use the Visitor pattern when:
- You need to add many unrelated operations to a stable object structure
- The object structure changes rarely
- You want to separate algorithms from object data

## Structure

```
Visitor -> ConcreteVisitor
Element -> ConcreteElement
```

## Participants

1. **Visitor**: Defines visit methods (`IVisitor`)
2. **Concrete Visitor**: Implements operations (`PriceVisitor`, `DiscountVisitor`)
3. **Element**: Accepts visitors (`IElement`, `Book`, `Electronics`)

## Implementation in Vim9script

The example uses Vim9 classes, interfaces, enums, type aliases, and abstract classes:

```vim
interface IVisitor
  def VisitBook(book: Book, output: list<string>): void
endinterface

class Book implements IElement
endclass
```

## Examples Included

### 1. Shopping Cart Visitors
**Scenario**: Price and discount calculations apply to cart items.

**Components**:
- Elements: `Book`, `Electronics`
- Visitors: `PriceVisitor`, `DiscountVisitor`
- Object Structure: `Cart`

**Usage**:
```vim
var cart = Cart.new()
cart.Add(Book.new('Clean Code', 30.0))
cart.Apply(PriceVisitor.new(), [])
```

## Running the Examples

### Source the file
```vim
:source behavioral-patterns/visitor/visitor_pattern.vim
```

### Run the complete demo
```vim
:call g:RunVisitorPatternDemo()
```

## Key Concepts Demonstrated

1. **Double Dispatch** between visitor and element
2. **Open/Closed Principle** for adding operations
3. **Stable Object Structure** with changing behaviors

## Advantages

1. **Add Operations Easily** without changing elements
2. **Separation of Concerns** between data and behavior
3. **Centralized Algorithms** in visitors

## Disadvantages

1. **Element Changes Costly**: New element types require visitor updates
2. **Tight Coupling**: Visitors depend on concrete element types

## Related Patterns

- **Composite**: Often paired with visitors for traversal
- **Iterator**: Can be used to traverse elements before visiting
- **Strategy**: Encapsulates algorithms without double dispatch

## Vim9script Notes

- Interfaces formalize visit contracts
- Enums represent element types
- Type aliases clarify prices

## Requirements

- Vim 9.0 or later (for Vim9script class support)
- No external dependencies

## License

MIT License - Feel free to use this for learning and teaching design patterns!

## Credits

These design pattern examples were generated by GitHub Copilot to demonstrate modern Vim9script capabilities and software design principles.

## References

For more information about the Visitor pattern, visit:

- **Refactoring.Guru**: [Visitor Pattern](https://refactoring.guru/design-patterns/visitor)
- **Gang of Four Book**: "Design Patterns: Elements of Reusable Object-Oriented Software" by Gamma, Helm, Johnson, Vlissides - Pages 331-344
- **Wikipedia**: [Visitor Pattern](https://en.wikipedia.org/wiki/Visitor_pattern)
- **SourceMaking**: [Visitor Design Pattern](https://sourcemaking.com/design_patterns/visitor)

## Conclusion

The Visitor pattern lets you add new operations to object structures without modifying the elements. This Vim9script example demonstrates price and discount visitors applied to a shopping cart.
